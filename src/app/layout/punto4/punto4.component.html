<h2>Venta de pasajes</h2>

<p>Ingrese los datos solicitados:</p>

<form>
  <div class="mb-3">
    <label for="dni" class="form-label">DNI:</label>
    <input type="text" class="form-control" [(ngModel)]="boleto.dni" name="dni" required>
  </div>
  <div class="mb-3">
    <label for="nombre" class="form-label">Nombre:</label>
    <input type="text" class="form-control" [(ngModel)]="boleto.nombre" name="nombre" required>
  </div>
  <div class="mb-3">
    <label for="apellido" class="form-label">Apellido:</label>
    <input type="text" class="form-control" [(ngModel)]="boleto.nombre" name="apellido" required>
  </div>
  <div class="mb-3">
    <label for="email" class="form-label">Email:</label>
    <input type="email" class="form-control" [(ngModel)]="boleto.email" name="email" required>
  </div>

  <div class="mb-3">
    <label for="fechaCompra" class="form-label">Fecha de compra:</label>
    <input type="date" class="form-control" [(ngModel)]="boleto.fechaCompra" name="fechaCompra" required>
  </div>

  <div>
    <label class="form-label">Precio base:</label>
    <input class="form-control" type="number" [(ngModel)]="precioBase" name="precioBase"
      (change)="actualizarPrecio()" /><br />
  </div>

  <div class="mb-3 form-floating">
    <label class="input-group-text" for="categoriaTurista">Opciones</label>
    <select class="form-select" [(ngModel)]="boleto.categoriaTurista" name="categoriaTurista" required>
      <option [ngValue]="null" disabled selected>Seleccione...</option>
      <option [ngValue]="1">Menor</option>
      <option [ngValue]="2">Adulto</option>
      <option [ngValue]="3">Jubilado</option>
    </select>

  </div>

  <!-- Mostrar precio final solo si hay precio y categoría -->
  <div *ngIf="boleto.categoriaTurista && precioBase">
    <label class="form-label">Precio con descuento:</label>
    <strong>{{ precioFinal | currency:'ARS':'symbol' }}</strong>
  </div>

  <div>
    <button class="btn btn-success" (click)="agregarBoleto()">Registrar venta</button>
  </div>


</form>

<hr>
<h3>Lista de boletos vendidos</h3>
<table datatable [dtOptions]="dtOptions" class="table table-striped table-bordered" id="miTabla">
  <thead>
    <tr>
      <th>DNI</th>
      <th>Nombre</th>
      <th>Email</th>
      <th>Categoría</th>
      <th>Fecha</th>
      <th>Precio</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let b of boletosVendidos">
      <td>{{ b.dni }}</td>
      <td>{{ b.nombre }}</td>
      <td>{{ b.email }}</td>
      <td>{{ b.categoriaTurista }}</td>
      <td>{{ b.fechaCompra | date:'dd/MM/yy' }}</td>
      <td>{{ b.precio | currency:'ARS':'symbol' }}</td>
      <td>
        <button class="btn btn-danger" (click)="eliminarBoleto(b.dni)">Eliminar</button>
    </tr>
  </tbody>
</table>

<hr>
<h3>Resumen de Ventas</h3>

<div class="col-md-6">
  <label for="categoriaResumen" class="form-label">Filtrar por categoría</label>
  <select class="form-select" id="categoriaResumen" [(ngModel)]="categoriaSeleccionada" name="categoriaResumen"
    (change)="actualizarResumen()">
    <option [ngValue]="0">Todas</option>
    <option *ngFor="let categoria of categorias" [ngValue]="categoria.id">
      {{ categoria.nombre }}
    </option>
  </select>
</div>

<ul class="list-group mt-3">
  <li class="list-group-item">Cantidad de boletos vendidos: {{ resumenTotalVentas }}</li>
  <li class="list-group-item">Total recaudado: {{ resumenTotalRecaudado | currency:'ARS' }}</li>
</ul>